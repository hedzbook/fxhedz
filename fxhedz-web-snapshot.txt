
==================================================
WEB PROJECT STRUCTURE
==================================================

.env.local
.gitignore
app\api\auth\[...nextauth]\route.ts
app\api\image\route.ts
app\api\native-auth\route.ts
app\api\public-preview\route.ts
app\api\refresh\route.ts
app\api\register-push\route.ts
app\api\signals\route.ts
app\api\subscription\route.ts
app\api\toggle-notification\route.ts
app\globals.css
app\layout.tsx
app\page.tsx
components\AccessOverlay.tsx
components\AccountStrip.tsx
components\AuthButton.tsx
components\ControlPanel.tsx
components\DashboardControlBar.tsx
components\GlobalLightChart.tsx
components\PairCard.tsx
components\PairDetail.tsx
components\Providers.tsx
components\VerticalSymbolButton.tsx
eslint.config.mjs
lib\device.ts
lib\dummyDetail.ts
lib\dummySignals.ts
lib\jwt.ts
next.config.ts
next-env.d.ts
package.json
package-lock.json
postcss.config.js
public\favicon.png
public\file.svg
public\globe.svg
public\logo.png
public\next.svg
public\vercel.svg
public\window.svg
public\zlchs.png
tailwind.config.js
tsconfig.json

==================================================
FULL WEB SOURCE CODE
==================================================


// app\api\auth\[...nextauth]\route.ts
// --------------------------------------------------

import NextAuth, { type NextAuthOptions } from "next-auth"
import GoogleProvider from "next-auth/providers/google"
import { cookies } from "next/headers"

export const authOptions: NextAuthOptions = {
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
  ],

  secret: process.env.NEXTAUTH_SECRET,

  callbacks: {
async signIn({ user }) {
  try {
    if (user?.email) {

      const cookieStore = await cookies()

      const deviceId = cookieStore.get("fx_device")?.value || ""
      const fingerprint = cookieStore.get("fx_fp")?.value || ""

      let platform = "web"
      let telegramChatId = ""

      const platformCookie = cookieStore.get("fx_platform")?.value
      const tgIdCookie = cookieStore.get("fx_tg_id")?.value

      if (platformCookie === "telegram") {
        platform = "telegram"
        telegramChatId = tgIdCookie || ""
      } else if (platformCookie === "android") {
        platform = "android"
      }

      await fetch(process.env.GAS_AUTH_URL!, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: user.email,
          device_id: deviceId,
          fingerprint: fingerprint,
          platform,
          telegram_chat_id: telegramChatId
        }),
      })
    }
  } catch (e) {
    console.error("Auth sync failed:", e)
  }

  return true
}
  }
}

const handler = NextAuth(authOptions)

export { handler as GET, handler as POST }



// app\api\image\route.ts
// --------------------------------------------------

import { NextRequest } from "next/server"

export async function GET(req: NextRequest) {
  const id = req.nextUrl.searchParams.get("id")

  if (!id) {
    return new Response("Missing id", { status: 400 })
  }

  const GAS_URL =
    "https://script.google.com/macros/s/AKfycby55ye_dTtWJ-QILNYJIaXWv74_n7n0muh3U--sBl7yowMlp1FzESOokWqeHI75U5_R/exec"

  const res = await fetch(`${GAS_URL}?image=${id}`, {
    cache: "no-store",
  })

  if (!res.ok) {
    return new Response("Image not found", { status: 404 })
  }

  const buffer = await res.arrayBuffer()

  return new Response(buffer, {
    headers: {
      "Content-Type": res.headers.get("content-type") || "image/jpeg",
      "Cache-Control": "public, max-age=600",
    },
  })
}



// app\api\native-auth\route.ts
// --------------------------------------------------

import { NextRequest, NextResponse } from "next/server"
import { OAuth2Client } from "google-auth-library"
import jwt from "jsonwebtoken"
import crypto from "crypto"

const ACCESS_EXPIRES_IN = "15m"
const REFRESH_EXPIRES_DAYS = 14

export async function POST(req: NextRequest) {
  try {

    const { idToken, deviceId, pushToken } = await req.json()

    if (!idToken || !deviceId) {
      return NextResponse.json(
        { error: "Missing fields" },
        { status: 400 }
      )
    }

    // ðŸ”¹ Verify Google token
    const client = new OAuth2Client()

    const ticket = await client.verifyIdToken({
      idToken,
      audience: [
        process.env.GOOGLE_CLIENT_ID!,
        process.env.GOOGLE_ANDROID_CLIENT_ID!
      ]
    })

    const payload = ticket.getPayload()

    if (!payload?.email) {
      return NextResponse.json(
        { error: "Invalid Google token" },
        { status: 401 }
      )
    }

    const email = payload.email.toLowerCase()

    // ðŸ”¹ Generate refresh token
    const refreshToken = crypto.randomBytes(64).toString("hex")

    const refreshHash = crypto
      .createHash("sha256")
      .update(refreshToken)
      .digest("hex")

    const refreshExpires = new Date()
    refreshExpires.setDate(
      refreshExpires.getDate() + REFRESH_EXPIRES_DAYS
    )

    // ðŸ”¹ Register device in GAS (also validates subscription)
    const gasRes = await fetch(process.env.GAS_AUTH_URL!, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        email,
        device_id: deviceId,
        fingerprint: deviceId,
        platform: "android",
        refresh_token_hash: refreshHash,
        refresh_expires: refreshExpires.toISOString()
      })
    })

    const gasData = await gasRes.json()

    if (!gasData.active) {
      return NextResponse.json(
        { error: "Subscription inactive" },
        { status: 403 }
      )
    }

    // ðŸ”¹ Save push token ONLY if subscription active
    if (pushToken) {
      await fetch(process.env.GAS_AUTH_URL!, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email,
          push_token: pushToken
        })
      })
    }

    // ðŸ”¹ Issue access token
    const accessToken = jwt.sign(
      { email, deviceId },
      process.env.FXHEDZ_SECRET!,
      { expiresIn: ACCESS_EXPIRES_IN }
    )

    return NextResponse.json({
      accessToken,
      refreshToken,
      email
    })

  } catch (err) {
    return NextResponse.json(
      { error: "Auth failed" },
      { status: 401 }
    )
  }
}



// app\api\public-preview\route.ts
// --------------------------------------------------

import { NextRequest, NextResponse } from "next/server"

const GAS_BASE =
  "https://script.google.com/macros/s/AKfycby55ye_dTtWJ-QILNYJIaXWv74_n7n0muh3U--sBl7yowMlp1FzESOokWqeHI75U5_R/exec"

function generateFallbackCandles(basePrice: number = 2000) {
  const candles = []
  let price = basePrice || 2000

  const now = Math.floor(Date.now() / 1000)

  for (let i = 40; i > 0; i--) {
    const open = price
    const volatility = basePrice * 0.002

    const close =
      open + (Math.random() - 0.5) * volatility

    const high =
      Math.max(open, close) + Math.random() * volatility * 0.5

    const low =
      Math.min(open, close) - Math.random() * volatility * 0.5

    candles.push({
      time: now - i * 900,
      open,
      high,
      low,
      close
    })

    price = close
  }

  return candles
}

export async function GET(req: NextRequest) {
  try {
    const pair = req.nextUrl.searchParams.get("pair") || "XAUUSD"

    const res = await fetch(
      `${GAS_BASE}?secret=${process.env.GAS_SECRET}&pair=${pair}`,
      { next: { revalidate: 10 } }
    )

    const json = await res.json()

    const basePrice =
      Number(json?.price) ||
      Number(json?.entry) ||
      2000

    const candles =
      json?.candles?.length
        ? json.candles.slice(-40)
        : generateFallbackCandles(basePrice)

    return NextResponse.json({
      direction: json?.direction,
      price: json?.price,
      entry: json?.entry,
      sl: json?.sl,
      tp: json?.tp,
      candles
    })

  } catch {
    return NextResponse.json(
      { error: "Preview unavailable" },
      { status: 500 }
    )
  }
}



// app\api\refresh\route.ts
// --------------------------------------------------

import { NextRequest, NextResponse } from "next/server"
import jwt from "jsonwebtoken"
import crypto from "crypto"

const ACCESS_EXPIRES_IN = "15m"

export async function POST(req: NextRequest) {
  try {
    const { refreshToken, deviceId, email } = await req.json()

    if (!refreshToken || !deviceId || !email) {
      return NextResponse.json({ error: "Missing fields" }, { status: 400 })
    }

    // ðŸ” Hash incoming refresh token
    const refreshHash = crypto
      .createHash("sha256")
      .update(refreshToken)
      .digest("hex")

    // ðŸ”Ž Ask GAS to validate
    const gasRes = await fetch(process.env.GAS_AUTH_URL!, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        refresh_validate: true,
        email,
        device_id: deviceId,
        refresh_token_hash: refreshHash
      })
    })

    const gasData = await gasRes.json()

    if (!gasData.valid) {
      return NextResponse.json(
        { error: "Invalid refresh token" },
        { status: 401 }
      )
    }

    // ðŸ”¹ Issue new access token
    const accessToken = jwt.sign(
      { email, deviceId },
      process.env.FXHEDZ_SECRET!,
      { expiresIn: ACCESS_EXPIRES_IN }
    )

    return NextResponse.json({ accessToken })

  } catch {
    return NextResponse.json({ error: "Refresh failed" }, { status: 401 })
  }
}



// app\api\register-push\route.ts
// --------------------------------------------------

import { NextRequest, NextResponse } from "next/server"
import { verifyAccessToken } from "@/lib/jwt"

export async function POST(req: NextRequest) {

  const jwtUser = verifyAccessToken(req)

  if (!jwtUser || typeof jwtUser !== "object") {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 })
  }

  const { pushToken } = await req.json()
  const email = (jwtUser as any).email

  if (!pushToken) {
    return NextResponse.json({ error: "Missing token" }, { status: 400 })
  }

  await fetch(process.env.GAS_AUTH_URL!, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      email,
      push_token: pushToken
    })
  })

  return NextResponse.json({ success: true })
}



// app\api\signals\route.ts
// --------------------------------------------------

import { NextRequest, NextResponse } from "next/server"
import { getServerSession } from "next-auth"
import { authOptions } from "../auth/[...nextauth]/route"
import { verifyAccessToken } from "@/lib/jwt"

const GAS_BASE =
  "https://script.google.com/macros/s/AKfycby55ye_dTtWJ-QILNYJIaXWv74_n7n0muh3U--sBl7yowMlp1FzESOokWqeHI75U5_R/exec"

export async function GET(req: NextRequest) {

  const jwtUser = verifyAccessToken(req)

  let email: string | null = null

  if (jwtUser && typeof jwtUser === "object") {
    email = (jwtUser as any).email
  }

  if (!email) {
    const session = await getServerSession(authOptions)
    email = session?.user?.email || null
  }

  if (!email) {
    return NextResponse.json(
      { error: "Unauthorized" },
      { status: 401 }
    )
  }

  try {
    const pair = req.nextUrl.searchParams.get("pair")

    const url = pair
      ? `${GAS_BASE}?secret=${process.env.GAS_SECRET}&email=${encodeURIComponent(email)}&pair=${pair}`
      : `${GAS_BASE}?secret=${process.env.GAS_SECRET}&email=${encodeURIComponent(email)}`

    const res = await fetch(url, { cache: "no-store" })
    const json = await res.json()

    if (pair && json?.signals?.[pair]) {
      return NextResponse.json({
        ...json.signals[pair],
        feed: json.feed || [],
        history: json.history || [],
        performance: json.performance || {},
        blocked: json.blocked,
        active: json.active,
        plan: json.plan,
        expiry: json.expiry,

        // ðŸ”¥ ADD THESE:
        appInstruments: json.appInstruments || [],
        webInstruments: json.webInstruments || [],
        telegramInstruments: json.telegramInstruments || []
      })
    }

    return NextResponse.json({
      ...json,
      appInstruments: json.appInstruments || [],
      webInstruments: json.webInstruments || [],
      telegramInstruments: json.telegramInstruments || []
    })

  } catch {
    return NextResponse.json(
      { error: "Signal fetch failed" },
      { status: 500 }
    )
  }
}



// app\api\subscription\route.ts
// --------------------------------------------------

import { NextRequest, NextResponse } from "next/server"
import { verifyAccessToken } from "@/lib/jwt"
import { getServerSession } from "next-auth"
import { authOptions } from "../auth/[...nextauth]/route"

export async function GET(req: NextRequest) {

  const jwtUser = verifyAccessToken(req)
  const session = await getServerSession(authOptions)

  let deviceId: string | undefined
  let email: string | undefined

  // ===============================
  // ANDROID (JWT)
  // ===============================
  if (jwtUser && typeof jwtUser === "object") {
    deviceId = (jwtUser as any).deviceId
    email = (jwtUser as any).email
  }

  // ===============================
  // WEB (NextAuth Session)
  // ===============================
  if (!email && session?.user?.email) {
    email = session.user.email
  }

  // ===============================
  // DEVICE COOKIE FALLBACK
  // ===============================
  if (!deviceId) {
    deviceId = req.cookies.get("fx_device")?.value
  }

  // ===============================
  // REQUIRE IDENTITY
  // ===============================
  if (!email || !deviceId) {
    return NextResponse.json(
      { error: "Unauthorized" },
      { status: 401 }
    )
  }

  try {
    const res = await fetch(
      `${process.env.GAS_AUTH_URL}?secret=${process.env.GAS_SECRET}&email=${encodeURIComponent(email)}`,
      { cache: "no-store" }
    )

    if (!res.ok) {
      throw new Error("GAS request failed")
    }

    const data = await res.json()

    // ===============================
    // NORMALIZE PLAN
    // ===============================
    const rawPlan =
      (data?.plan || data?.status || "").toLowerCase()

    const expiryRaw =
      data?.expiry ? new Date(data.expiry) : null

    const now = new Date()

    // ===============================
    // ENFORCE EXPIRY
    // ===============================
    const isLivePlusActive =
      rawPlan === "live+" &&
      expiryRaw &&
      expiryRaw > now

    const finalPlan =
      isLivePlusActive ? "live+" : "live"

    return NextResponse.json({
      active: true,               // LIVE base is always active
      blocked: false,
      status: finalPlan,
      expiry: expiryRaw ?? null
    })

  } catch (err) {

    return NextResponse.json({
      active: false,
      blocked: true,
      status: null,
      expiry: null
    })

  }
}



// app\api\toggle-notification\route.ts
// --------------------------------------------------

import { NextRequest, NextResponse } from "next/server"
import { verifyAccessToken } from "@/lib/jwt"
import { getServerSession } from "next-auth"
import { authOptions } from "../auth/[...nextauth]/route"

export async function POST(req: NextRequest) {

  let email: string | null = null

  // ============================
  // ANDROID (JWT)
  // ============================
  const jwtUser = verifyAccessToken(req)
  if (jwtUser && typeof jwtUser === "object") {
    email = (jwtUser as any).email
  }

  // ============================
  // WEB / TELEGRAM (SESSION)
  // ============================
  if (!email) {
    const session = await getServerSession(authOptions)
    email = session?.user?.email || null
  }

  if (!email) {
    return NextResponse.json(
      { error: "Unauthorized" },
      { status: 401 }
    )
  }

  // ============================
  // READ BODY (ATOMIC TOGGLE)
  // ============================
  const body = await req.json()
  const pair = body?.pair
  const action = body?.action

  if (
    !pair ||
    !["add", "remove"].includes(action)
  ) {
    return NextResponse.json(
      { error: "Invalid toggle request" },
      { status: 400 }
    )
  }

  const cleanPair = String(pair)
    .toUpperCase()
    .trim()

  // ============================
  // PLATFORM DETECTION
  // ============================
  const platform =
    req.cookies.get("fx_platform")?.value || "web"

  // ============================
  // BUILD GAS PAYLOAD
  // ============================
  const payload: any = {
    email,
    toggle_pair: cleanPair,
    toggle_action: action,
    toggle_platform: platform
  }

  // ============================
  // SEND TO GAS
  // ============================
  const res = await fetch(process.env.GAS_AUTH_URL!, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(payload)
  })

  if (!res.ok) {
    return NextResponse.json(
      { error: "GAS update failed" },
      { status: 500 }
    )
  }

  const data = await res.json()

  return NextResponse.json(data)
}



// app\layout.tsx
// --------------------------------------------------

import type { Metadata } from "next"
import { Geist, Geist_Mono } from "next/font/google"
import Script from "next/script"
import Providers from "@/components/Providers"
import "./globals.css"
import { Analytics } from "@vercel/analytics/next"

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
})

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
})

export const metadata: Metadata = {
  title: "FXHEDZ",
  description: "Live Forex & Crypto Trading Dashboard",
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased tracking-tight`}
      >
        <Script
          src="https://telegram.org/js/telegram-web-app.js"
          strategy="beforeInteractive"
        />

        <Providers>
          {children}
        </Providers>

      </body>
    </html>
  )
}



// app\page.tsx
// --------------------------------------------------

"use client"

import React, { useEffect, useState, useMemo, useRef } from "react"
import PairCard from "@/components/PairCard"
import AccountStrip from "@/components/AccountStrip"
import VerticalSymbolButton from "@/components/VerticalSymbolButton"
import PairDetail from "@/components/PairDetail"
import AuthButton from "@/components/AuthButton"
import { useSession } from "next-auth/react"
import AccessOverlay from "@/components/AccessOverlay"
import { generateDummySignals } from "@/lib/dummySignals"
import { ensureDeviceIdentity } from "@/lib/device"
import { signOut } from "next-auth/react"
import { generateDummyDetail } from "@/lib/dummyDetail"
import ControlPanel from "@/components/ControlPanel"

import {
  DndContext,
  closestCenter,
  MouseSensor,
  TouchSensor,
  useSensor,
  useSensors
} from "@dnd-kit/core"

import {
  SortableContext,
  verticalListSortingStrategy,
  useSortable,
  arrayMove
} from "@dnd-kit/sortable"

import { CSS } from "@dnd-kit/utilities"

const DEFAULT_ORDER = [
  "ETHUSD",
  "USDCHF",
  "USDJPY",
  "XAUUSD",
  "EURUSD",
  "GBPUSD",
  "AUDUSD",
  "USOIL",
  "BTCUSD"
]
type PairKey =
  | "ETHUSD"
  | "USDCHF"
  | "USDJPY"
  | "XAUUSD"
  | "EURUSD"
  | "GBPUSD"
  | "AUDUSD"
  | "USOIL"
  | "BTCUSD"
const SIGNAL_API = "/api/signals"

type ViewMode = "MIN" | "MAX"

type SubscriptionMeta = {
  active?: boolean
  status?: string | null
  expiry?: string | null
  blocked?: boolean
}

export default function Page() {

  const dummySignals = useMemo(() => generateDummySignals(), [])
  const [signals, setSignals] = useState<any>(dummySignals)
  const [pairData, setPairData] = useState<any>({})
  const [openPair, setOpenPair] = useState<string | null>(null)
  const [uiSignals, setUiSignals] = useState<any>({})
  const [netState, setNetState] = useState("FLAT")
  const [menuOpen, setMenuOpen] = useState(false)
  const [isMobile, setIsMobile] = useState(false)
  const [appInstruments, setAppInstruments] = useState<string[]>([])

  useEffect(() => {
    function check() {
      setIsMobile(window.innerWidth < 768)
    }

    check()
    window.addEventListener("resize", check)
    return () => window.removeEventListener("resize", check)
  }, [])
  const [subActive, setSubActive] = useState<boolean | null>(null)
  const { data: session, status } = useSession()
  const email =
  session?.user?.email ||
  (typeof window !== "undefined"
    ? (window as any).__NATIVE_EMAIL__
    : null)
  const isAndroid =
    typeof window !== "undefined" &&
    !!(window as any).ReactNativeWebView

  const hasNativeToken =
    isAndroid &&
    typeof window !== "undefined" &&
    (window as any).__HAS_NATIVE_TOKEN__ === true

  const isAuthenticated =
    status === "authenticated"

  const sessionExists =
    isAndroid
      ? hasNativeToken
      : !!session
  const [accessMeta, setAccessMeta] =
    useState<SubscriptionMeta | null>(null)
  async function loadPreview(pair: string) {
    try {
      const res = await fetch(`/api/public-preview?pair=${pair}`)
      const json = await res.json()

      setPairData((prev: any) => ({
        ...prev,
        [pair]: json
      }))
    } catch (e) {
      console.error("Preview load failed", e)
    }
  }
  const [instrumentOrder, setInstrumentOrder] =
    useState<PairKey[]>(DEFAULT_ORDER as PairKey[])

  const sensors = useSensors(
    useSensor(MouseSensor, {
      activationConstraint: {
        distance: 5
      }
    }),
    useSensor(TouchSensor, {
      activationConstraint: {
        delay: 150,
        tolerance: 8
      }
    })
  )
useEffect(() => {

  if (!email || !accessMeta) return

  async function loadInstruments() {

    try {

      const res = await fetch("/api/signals", {
        cache: "no-store"
      })

      const data = await res.json()

      const platform =
        document.cookie
          .split("; ")
          .find(r => r.startsWith("fx_platform="))
          ?.split("=")[1] || "web"

      if (platform === "telegram") {
        setAppInstruments(data.telegramInstruments || [])
      } else if (platform === "android") {
        setAppInstruments(data.appInstruments || [])
      } else {
        setAppInstruments(data.webInstruments || [])
      }

    } catch (err) {
      console.error("Instrument load failed", err)
    }
  }

  loadInstruments()

}, [email, accessMeta])
  useEffect(() => {
    const saved = localStorage.getItem("fxhedz_order")
    if (saved) {
      setInstrumentOrder(JSON.parse(saved))
    }
  }, [])

  useEffect(() => {
    localStorage.setItem("fxhedz_order", JSON.stringify(instrumentOrder))
  }, [instrumentOrder])
  const menuRef = useRef<HTMLDivElement | null>(null)
  const hamburgerRef = useRef<HTMLButtonElement | null>(null)
  const daysLeft = useMemo(() => {

    if (!accessMeta?.expiry) return null

    const now = new Date()
    const expiry = new Date(accessMeta.expiry)

    const diff = expiry.getTime() - now.getTime()
    const days = Math.ceil(diff / (1000 * 60 * 60 * 24))

    return days > 0 ? days : 0
  }, [accessMeta])

  useEffect(() => {

    function handleClickOutside(event: MouseEvent) {

      if (!menuOpen) return

      const target = event.target as Node

      if (
        menuRef.current &&
        !menuRef.current.contains(target) &&
        hamburgerRef.current &&
        !hamburgerRef.current.contains(target)
      ) {
        setMenuOpen(false)
      }
    }

    function handleEscape(event: KeyboardEvent) {
      if (event.key === "Escape") {
        setMenuOpen(false)
      }
    }

    document.addEventListener("mousedown", handleClickOutside)
    document.addEventListener("keydown", handleEscape)

    return () => {
      document.removeEventListener("mousedown", handleClickOutside)
      document.removeEventListener("keydown", handleEscape)
    }

  }, [menuOpen])

  useEffect(() => {

    if (status === "loading") return

    if (!isAuthenticated) {
      setSignals(generateDummySignals())
      return
    }

    if (subActive === false) {
      setSignals(generateDummySignals())
      return
    }

    if (subActive === null) return

    async function loadSignals() {
      try {
        const res = await fetch(SIGNAL_API)
        const json = await res.json()
        const incoming = json?.signals ?? {}

        setSignals(incoming)
      } catch { }
    }

    loadSignals()
    const interval = setInterval(loadSignals, 2500)
    return () => clearInterval(interval)

  }, [subActive, status, accessMeta])

  // =============================
  // CHECK SUBSCRIPTION STATUS
  // =============================
  useEffect(() => {

    if (status === "loading") return

    // ðŸ”¥ FIX: Only block unauthenticated for WEB
    if (!isAndroid && status === "unauthenticated") {
      setSubActive(false)
      return
    }



    async function init() {

      // ===============================
      // PLATFORM + DEVICE COOKIES
      // ===============================

      const params = new URLSearchParams(window.location.search)
      const urlPlatform = params.get("platform")
      const urlDeviceId = params.get("device_id")

      let platform = "web"

      if (urlPlatform === "android") {
        platform = "android"
      }

      try {
        const tg = (window as any)?.Telegram?.WebApp
        if (tg?.initDataUnsafe?.user?.id) {
          platform = "telegram"
          const tgUser = tg.initDataUnsafe.user
          document.cookie = `fx_tg_id=${tgUser.id}; path=/; max-age=31536000`
        }
      } catch { }

      let id = urlDeviceId || localStorage.getItem("fxhedz_device_id")

      if (!id) {
        id = crypto.randomUUID()
        localStorage.setItem("fxhedz_device_id", id)
      }

      document.cookie = `fx_device=${id}; path=/; max-age=31536000`
      document.cookie = `fx_platform=${platform}; path=/; max-age=31536000`

      // ===============================
      // SUBSCRIPTION CHECK
      // ===============================

      try {
        const res = await fetch(
          `/api/subscription`,
          { cache: "no-store" }
        )

        const data = await res.json()
        // alert("SUB DATA: " + JSON.stringify(data))
        console.log("SUB DATA:", data)

        setAccessMeta(data)
        setSubActive(Boolean(data?.active))

      } catch {
        setSubActive(false)
      }
    }

    init()

  }, [status])

  // =============================
  // SUBSCRIPTION POLLING (LIVE SYNC)
  // =============================
  useEffect(() => {

    if (!isAndroid && !isAuthenticated) return

    async function checkSubscription() {
      try {
        const res = await fetch("/api/subscription", {
          cache: "no-store"
        })

        const data = await res.json()

        setAccessMeta(prev => {
          if (JSON.stringify(prev) === JSON.stringify(data)) return prev
          return data
        })

        setSubActive(Boolean(data?.active))

      } catch { }
    }

    // poll every 10 seconds
    const interval = setInterval(checkSubscription, 10000)

    return () => clearInterval(interval)

  }, [isAuthenticated])

  useEffect(() => {
    setUiSignals(signals)
  }, [signals])

  useEffect(() => {

    if (!openPair) return

    if (isGuest) {
      loadPreview(openPair)
      return
    }


    const pairKey = openPair
    let cancelled = false

    async function refreshOpenPair() {
      try {

        const res = await fetch(`/api/signals?pair=${pairKey}`)
        const json = await res.json()
        if (cancelled) return

        setPairData((prev: any) => ({
          ...prev,
          [pairKey]: json
        }))
      } catch { }
    }

    refreshOpenPair()
    const interval = setInterval(refreshOpenPair, 6000)

    return () => {
      cancelled = true
      clearInterval(interval)
    }
  }, [openPair, subActive, status])

  function togglePair(pair: string) {
    // Toggle between open/close pair expansion
    if (openPair === pair) {
      setOpenPair(null) // Collapse the pair
    } else {
      setOpenPair(pair) // Expand the specific pair
    }
  }
  function handleDragEnd(event: any) {
    const { active, over } = event
    if (!over || active.id === over.id) return

    const oldIndex = instrumentOrder.indexOf(active.id)
    const newIndex = instrumentOrder.indexOf(over.id)

    setInstrumentOrder(arrayMove(instrumentOrder, oldIndex, newIndex))
  }
  const pairsData = useMemo(() => {
    return instrumentOrder.map((pair) => {
      const signal = uiSignals?.[pair]
      const extra = pairData?.[pair] || {}
      return { pair, signal, orders: extra?.orders || [] }
    })
  }, [uiSignals, pairData])

  const isGuest =
    !isAuthenticated ||
    subActive === false

  const plan = accessMeta?.status?.toLowerCase()

  const isLivePlus = plan === "live+"
  const isLive = plan === "live"

  const detailData = openPair
    ? (
      isGuest
        ? {
          ...pairData?.[openPair],
          ...generateDummyDetail(openPair),
          orders: uiSignals?.[openPair]?.orders || []
        }
        : pairData?.[openPair]
    )
    : undefined

  if (openPair) {
    console.log("DETAIL DATA:", detailData)
  }
  function SortableButton({ id, children }: any) {
    const {
      attributes,
      listeners,
      setNodeRef,
      transform,
      transition
    } = useSortable({ id })

    const style = {
      transform: CSS.Transform.toString(transform),
      transition
    }

    return (
      <div ref={setNodeRef} style={style} {...attributes} {...listeners}>
        {children}
      </div>
    )
  }
  function SortableRow({ id, children }: any) {
    const {
      attributes,
      listeners,
      setNodeRef,
      transform,
      transition
    } = useSortable({ id })

    const style = {
      transform: CSS.Transform.toString(transform),
      transition,
      willChange: "transform"
    }

    return (
      <div ref={setNodeRef} style={style}>
        {typeof children === "function"
          ? children({ attributes, listeners })
          : children}
      </div>
    )
  }
  return (
    <div className="relative">

      <main
        className="h-[100dvh] bg-black text-white flex flex-col"
      >

        {/* TOP BAR */}
        <div
          className="shrink-0 grid border-b border-neutral-800"
          style={{
            gridTemplateColumns: "clamp(30px, 3.5vw, 46px) 1fr",
            height: "clamp(28px,3.5vh,50px)"
          }}
        >

          {/* TOP LEFT BUTTON */}
          <button
            onClick={() => {
              setOpenPair(null)
            }}
            className="
    border-r border-neutral-800
    bg-neutral-000
    hover:bg-neutral-000
    flex items-center justify-center
  "
          >
            <img
              src="/favicon.png"
              alt="FXHEDZ"
              className="
      w-[80%]
      h-[90%]
      object-contain
      select-none
      pointer-events-none
    "
            />
          </button>

          {/* ACCOUNT STRIP */}
          <AccountStrip
            pairs={pairsData}
            onStateChange={(state: string) => {
              setNetState(state)
            }}
          />

        </div>

        {/* SCROLL AREA */}
        <div className="flex-1 overflow-hidden relative">

          {openPair ? (

            <div
              className="absolute inset-0 grid"
              style={{
                gridTemplateColumns: "clamp(30px, 3.5vw, 46px) 1fr",
                gridTemplateRows: "1fr"
              }}
            >

              {/* LEFT RAIL */}
              <div className="grid"
                style={{
                  gridTemplateRows: `repeat(${instrumentOrder.length}, 1fr)`
                }}
              >
                {instrumentOrder.map((pair) => (
                  <VerticalSymbolButton
                    key={pair}
                    pair={pair}
                    active={openPair === pair}
                    onClick={() =>
                      setOpenPair(prev => (prev === pair ? null : pair))
                    }
                  />
                ))}
              </div>

              {/* RIGHT DETAIL */}
              <PairDetail
                pair={openPair}
                data={detailData}
                signal={uiSignals?.[openPair]}
                onClose={() => setOpenPair(null)}
                isGuest={isGuest}
                email={session?.user?.email || (window as any).__NATIVE_EMAIL__}
                    appInstruments={appInstruments}
    setAppInstruments={setAppInstruments}
              />

            </div>

          ) : (

            <DndContext
              sensors={sensors}
              collisionDetection={closestCenter}
              onDragEnd={handleDragEnd}
            >
              <SortableContext
                items={instrumentOrder}
                strategy={verticalListSortingStrategy}
              >

                <div
                  className="grid h-full"
                  style={{
                    gridTemplateRows: `repeat(${instrumentOrder.length}, 1fr)`
                  }}
                >
                  {instrumentOrder.map((pair: PairKey) => {

                    const realSignal = uiSignals?.[pair]
                    const dummySignal = dummySignals[pair]

                    const isLivePair =
                      pair === "ETHUSD" || pair === "USDCHF"

                    const subscriptionReady =
                      subActive !== null &&
                      accessMeta !== null

                    const canAccess =
                      subscriptionReady &&
                      subActive === true &&
                      (
                        isLivePlus ||
                        (isLive && isLivePair)
                      )

                    const displaySignal =
                      !isAuthenticated
                        ? dummySignal
                        : canAccess
                          ? (realSignal ?? dummySignal)
                          : dummySignal

                    const displayDirection =
                      !isAuthenticated
                        ? dummySignal?.direction
                        : !subscriptionReady
                          ? dummySignal?.direction
                          : canAccess
                            ? realSignal?.direction
                            : "LIVE+"

                    return (
                      <SortableRow key={pair} id={pair}>
                        {({ attributes, listeners }: any) => (
                          <div className="flex h-full">

                            <div
                              className="h-full flex items-center justify-center cursor-grab active:cursor-grabbing"
                              style={{
                                width: "clamp(30px, 3.5vw, 46px)",
                                touchAction: "none"
                              }}
                              {...attributes}
                              {...listeners}
                            >
                              <VerticalSymbolButton
                                pair={pair}
                                active={false}
                                onClick={() => {
                                  if (!subscriptionReady) return
                                  if (!canAccess) return
                                  setOpenPair(prev => prev === pair ? null : pair)
                                }}
                              />
                            </div>

                            <div className="flex-1 h-full">
                              <PairCard
                                pair={pair}
                                open={openPair === pair}
                                direction={displayDirection}
                                signal={displaySignal}
                                onToggle={() => {
                                  if (!subscriptionReady) return
                                  if (!canAccess) return
                                  setOpenPair(prev => prev === pair ? null : pair)
                                }}
                                isGuest={!canAccess}
                              />
                            </div>

                          </div>
                        )}
                      </SortableRow>
                    )
                  })}

                </div>

              </SortableContext>
            </DndContext>

          )}

        </div>

        {/* MENU LAYER */}
        {menuOpen && (
          <div
            ref={menuRef}
            className={
              isMobile
                ? `
      absolute
      inset-x-0
      top-0
      bottom-[clamp(28px,3.5vh,50px)]
      z-40
      bg-neutral-950
      flex
      flex-col
    `
                : `
            absolute
            bottom-[clamp(28px,3.5vh,50px)]
            left-0
            z-50
            w-[min(92vw,360px)]
            max-h-[80vh]
            overflow-y-auto
            backdrop-blur-md
            bg-black/40
            rounded-lg
            shadow-xl
          `
            }
          >
            <ControlPanel
              accessMeta={accessMeta}
              deviceId={
                typeof window !== "undefined"
                  ? localStorage.getItem("fxhedz_device_id")
                  : null
              }
              version="v0.1.0"
            />
          </div>
        )}

        {/* BOTTOM BAR */}
        <div
          className="shrink-0 grid border-t border-neutral-800 relative"
          style={{
            gridTemplateColumns: "clamp(30px, 3.5vw, 46px) 1fr",
            height: "clamp(28px,3.5vh,50px)"
          }}
        >


          {/* BOTTOM LEFT BUTTON (HAMBURGER HERE) */}
          <button
            ref={hamburgerRef}
            onClick={() => setMenuOpen(prev => !prev)}
            className="
    border-r border-neutral-800
    bg-neutral-950
    hover:bg-neutral-900
    flex items-center justify-center
    relative
  "
          >
            <div
              className="
      relative
      w-[clamp(12px,1.6vh,18px)]
      h-[clamp(8px,1.2vh,14px)]
    "
            >

              {/* TOP LINE */}
              <span
                className={`
        absolute left-0
        w-full
        h-[clamp(1px,0.25vh,2px)]
        bg-neutral-400
        transition-all duration-300 ease-in-out
        ${menuOpen
                    ? "top-1/2 -translate-y-1/2 rotate-45"
                    : "top-0"}
      `}
              />

              {/* MIDDLE LINE */}
              <span
                className={`
        absolute left-0 top-1/2 -translate-y-1/2
        w-full
        h-[clamp(1px,0.25vh,2px)]
        bg-neutral-400
        transition-all duration-300 ease-in-out
        ${menuOpen ? "opacity-0" : ""}
      `}
              />

              {/* BOTTOM LINE */}
              <span
                className={`
        absolute left-0
        w-full
        h-[clamp(1px,0.25vh,2px)]
        bg-neutral-400
        transition-all duration-300 ease-in-out
        ${menuOpen
                    ? "top-1/2 -translate-y-1/2 -rotate-45"
                    : "bottom-0"}
      `}
              />

            </div>
          </button>

          {/* RIGHT SIDE CONTENT */}
          <div className="bg-neutral-900 flex items-center px-3">
            <div className="text-[clamp(11px,6.66px+1.354vw,24px)] font-semibold leading-none">
              FXHEDZ
            </div>

            <div className="ml-auto text-right flex flex-col items-end">
              <div className="text-[clamp(7px,0.9vh,12px)] leading-[11px]">
                ZEROLOSS COMPOUNDED
              </div>
              <div className="text-[clamp(8px,1vh,14px)] text-neutral-500 leading-[10px] tracking-[0.098em]">
                HEDGING SYSTEM
              </div>
            </div>
          </div>

        </div>

      </main>
      {status !== "loading" && (
        <AccessOverlay sessionExists={sessionExists} />
      )}
    </div>
  )
}



// components\AccessOverlay.tsx
// --------------------------------------------------

"use client"

import AuthButton from "./AuthButton"

type Props = {
  sessionExists: boolean
}

export default function AccessOverlay({ sessionExists }: Props) {

  // If logged in â†’ no overlay at all
  if (sessionExists) return null

  // If NOT logged in â†’ show login panel
  return (
    <OverlayContainer>
      <Panel>
        <Header />
        <Title>Institutional Sign-in</Title>
        <Description>
          Sign in to access FXHEDZ LIVE Terminal
        </Description>
        <div className="w-full flex justify-center">
          <AuthButton />
        </div>
      </Panel>
    </OverlayContainer>
  )
}

/* --- Styled Sub-Components --- */

function OverlayContainer({ children }: any) {
  return (
    <div
      className="
        fixed inset-x-0
        bottom-[clamp(28px,3.5vh,50px)]
        z-[999]
        flex justify-center
        px-4
      "
    >
      {children}
    </div>
  )
}

function Panel({ children }: any) {
  return (
    <div
      className="
        w-full max-w-[clamp(220px,80vw,340px)]
        px-[clamp(12px,3vw,22px)]
        py-[clamp(12px,3vh,24px)]
        bg-[#0d0d0d]
        border border-neutral-800
        rounded-xl
        shadow-[0_10px_40px_rgba(0,0,0,0.7)]
        flex flex-col items-center text-center
      "
    >
      {children}
    </div>
  )
}

function Header() {
  return (
    <div className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] tracking-[0.3em] text-blue-500 font-black mb-4 uppercase">
      FXHEDZ <span className="text-white">LIVE</span>
    </div>
  )
}

function Title({ children }: any) {
  return (
    <h2 className="text-[clamp(11px,6.66px+1.354vw,24px)] font-bold text-white tracking-tight mb-2">
      {children}
    </h2>
  )
}

function Description({ children }: any) {
  return (
    <p className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] leading-[1.3] text-neutral-400 mb-4">
      {children}
    </p>
  )
}



// components\AccountStrip.tsx
// --------------------------------------------------

"use client"

import { useEffect } from "react"

export default function AccountStrip({
    pairs,
    onStateChange
}: {
    pairs: any[]
    onStateChange?: (state: string, intensity: number, pulse: number) => void
}) {

    let totalFloating = 0
    let totalLots = 0
    let buyVol = 0
    let sellVol = 0

    pairs.forEach(p => {

        const orders = p.signal?.orders || []

        orders.forEach((pos: any) => {
            const lot = Number(pos.lots || 0)
            const pnl = Number(pos.profit || 0)

            totalLots += lot
            totalFloating += pnl

            if (pos.direction === "BUY") buyVol += lot
            if (pos.direction === "SELL") sellVol += lot
        })

    })

    const netState =
        buyVol === 0 && sellVol === 0
            ? "FLAT"
            : buyVol === sellVol
                ? "HEDGED"
                : buyVol > sellVol
                    ? "NET BUY"
                    : "NET SELL"

    const imbalance = Math.abs(buyVol - sellVol)
    const totalVol = buyVol + sellVol || 1
    const intensity = Math.min(1, imbalance / totalVol)
    const pulse = Math.min(1, Math.abs(totalFloating) / (totalLots || 1))

    useEffect(() => {
        if (typeof onStateChange === "function") {
            onStateChange(netState, intensity, pulse)
        }
    }, [netState, intensity, pulse])

return (
  <div className="h-full bg-neutral-900 flex px-3">

    <div className="flex-1 h-full flex items-center text-left text-[clamp(9px,5.5px+1.0937vw,19.5px)] leading-none">
<div className="flex items-center gap-[clamp(4px,0.6vw,8px)]">
  <span className="text-neutral-400">LOTS</span>
  <span className="font-semibold">{totalLots.toFixed(2)}</span>
</div>
    </div>

    <div className="flex-1 h-full flex items-center justify-center text-[clamp(9px,5.5px+1.0937vw,19.5px)] leading-none">
<div className="flex items-center gap-[clamp(4px,0.6vw,8px)]">
  <span className="text-neutral-400">~PnL</span>
  <span className={totalFloating >= 0 ? "text-green-400" : "text-red-400"}>
    {totalFloating.toFixed(2)}
  </span>
</div>
    </div>

    <div className="flex-1 h-full flex items-center justify-end text-[clamp(9px,5.5px+1.0937vw,19.5px)] font-semibold text-sky-400 leading-none">
      {netState}
    </div>

  </div>
)

}



// components\AuthButton.tsx
// --------------------------------------------------

"use client"

import { signIn, signOut, useSession } from "next-auth/react"
import { ensureDeviceIdentity } from "@/lib/device"

export default function AuthButton() {
  const { data: session, status } = useSession()
  const isAndroid =
  typeof window !== "undefined" &&
  (window as any).ReactNativeWebView

const hasNativeToken =
  isAndroid &&
  typeof window !== "undefined" &&
  Boolean((window as any).__HAS_NATIVE_TOKEN__)

  if (status === "loading") {
    return (
      <div className="flex items-center gap-2">
        <div className="w-3 h-3 border-2 border-neutral-600 border-t-blue-500 rounded-full animate-spin" />
        <span className="text-neutral-500 text-[clamp(9px,5.5px+1.0937vw,19.5px)] uppercase tracking-widest font-bold">Syncing...</span>
      </div>
    )
  }

  // LOGIN STATE (Colorful Google Style)
  if (!session && (!isAndroid || !hasNativeToken)) {
    return (
      <button
        onClick={() => {

          ensureDeviceIdentity()

          // If inside Android WebView Ã¢â€ â€™ trigger native login
          if (typeof window !== "undefined" && (window as any).ReactNativeWebView) {
            (window as any).ReactNativeWebView.postMessage("LOGIN_REQUEST")
          } else {
            signIn("google")
          }
        }}
        className="
          flex items-center justify-center gap-3 
          w-full max-w-[clamp(140px,65vw,200px)]
py-[clamp(6px,1.8vh,10px)]
px-[clamp(10px,3vw,18px)]
text-[clamp(9px,5.5px+1.0937vw,19.5px)]
          bg-white hover:bg-neutral-50 
          rounded-md border border-neutral-300
          shadow-sm transition-all duration-200
          active:scale-[0.98]
        "
      >
        <GoogleIcon />
        <span>Sign in with Google</span>
      </button>
    )
  }

  // LOGOUT STATE (Clean & Minimal)
if (session || (isAndroid && hasNativeToken)) {
  return (
    <div className="flex flex-col items-center gap-3 w-full">
      {!isAndroid && (
        <div className="px-3 py-1 bg-neutral-800/50 rounded-full border border-neutral-700/50">
          <span className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400 font-mono truncate max-w-[180px] block">
            {session?.user?.email}
          </span>
        </div>
      )}

      <button
        onClick={() => {
          if (isAndroid) {
            (window as any).ReactNativeWebView.postMessage("LOGOUT_REQUEST")
            return
          }
          signOut()
        }}
        className="
          text-[clamp(9px,5.5px+1.0937vw,19.5px)] font-black uppercase tracking-tighter
          text-red-500/80 hover:text-red-500
          transition-colors duration-200
        "
      >
        [ Sign Out Terminal ]
      </button>
    </div>
  )
}
}

function GoogleIcon() {
  return (
    <svg
      className="w-[clamp(14px,3vw,20px)] h-[clamp(14px,3vw,20px)] shrink-0"
      viewBox="0 0 18 18"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4" />
      <path d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 009 18z" fill="#34A853" />
      <path d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.712s.102-1.173.282-1.712V4.956H.957a8.996 8.996 0 000 8.088l3.007-2.332z" fill="#FBBC05" />
      <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 00.957 4.956l3.007 2.332C4.672 5.164 6.656 3.58 9 3.58z" fill="#EA4335" />
    </svg>
  )
}



// components\ControlPanel.tsx
// --------------------------------------------------

"use client"

import { useMemo } from "react"
import { signOut, useSession } from "next-auth/react"

type Props = {
    accessMeta: {
        active?: boolean
        status?: string | null
        expiry?: string | null
    } | null
    deviceId?: string | null
    version: string
}

const PLAN = {
    label: "LIVE+ Monthly",
    price: "$9.99 / month",
    razorpayLink: "https://rzp.io/l/fxhedz_monthly", // replace with real link
    playSku: "fxhedz_liveplus_monthly"
}

export default function ControlPanel({
    accessMeta,
    deviceId,
    version
}: Props) {

    const { data: session } = useSession()

    const isAndroid =
        typeof window !== "undefined" &&
        !!(window as any).ReactNativeWebView

    const nativeEmail =
        typeof window !== "undefined"
            ? (window as any).__NATIVE_EMAIL__ || null
            : null

    const daysLeft = useMemo(() => {
        if (!accessMeta?.expiry) return null
        const now = new Date()
        const expiry = new Date(accessMeta.expiry)
        const diff = expiry.getTime() - now.getTime()
        return Math.max(0, Math.ceil(diff / (1000 * 60 * 60 * 24)))
    }, [accessMeta])

    function handleUpgrade() {

        if (isAndroid) {
            (window as any).ReactNativeWebView.postMessage(
                JSON.stringify({
                    type: "PLAY_BILLING_REQUEST",
                    sku: PLAN.playSku
                })
            )
            return
        }

        window.open(PLAN.razorpayLink, "_blank")
    }

    function handleLogout() {
        if (isAndroid) {
            (window as any).ReactNativeWebView.postMessage("LOGOUT_REQUEST")
            return
        }
        signOut()
    }

    const status = accessMeta?.status?.toLowerCase()
    const isAccountActive = Boolean(accessMeta?.active)
    const isLivePlus = status === "live+"
    const planName = (status || "none").toUpperCase()

    return (
        <div
            className="
    w-full
    flex
    flex-col
    flex-1
    overflow-y-auto
    bg-neutral-900
    pt-6
    pb-4
    px-4
    space-y-6
    text-[clamp(9px,5.5px+1.0937vw,19.5px)]
  "
        >

            {/* ================= ACCOUNT BLOCK ================= */}
            <Block title="Account">

                <Row
                    label="Email"
                    value={
                        isAndroid
                            ? nativeEmail || "â€”"
                            : session?.user?.email || "â€”"
                    }
                />

                <Row
                    label="Plan"
                    value={planName}
                    highlight={isLivePlus ? "green" : undefined}
                />

                <Row
                    label="Status"
                    value={isAccountActive ? "ACTIVE" : "EXPIRED"}
                    highlight={isAccountActive ? "green" : "red"}
                />

                {deviceId && (
                    <DeviceBlock deviceId={deviceId} />
                )}

            </Block>

            {/* ================= SUBSCRIPTION BLOCK ================= */}
            <Block title="Subscription">

                {!isLivePlus ? (

                    <button
                        onClick={handleUpgrade}
                        className="w-full py-3 bg-sky-600 hover:bg-sky-500 rounded-md font-semibold transition-colors"
                    >
                        Upgrade to LIVE+
                        <div className="text-xs text-sky-200 mt-1">
                            {PLAN.price}
                        </div>
                    </button>

                ) : (

                    <div className="w-full py-3 bg-emerald-600 rounded-md font-semibold text-center">
                        LIVE+ ACTIVE
                    </div>

                )}

                <div className="text-neutral-400 text-xs leading-relaxed">
                    LIVE+ provides full institutional access with real-time signals across all instruments.
                </div>

            </Block>

            {/* ================= SYSTEM BLOCK ================= */}
            <Block title="System">

                <Row label="Version" value={version} mono />
                <Row label="Platform" value={isAndroid ? "ANDROID" : "WEB"} />
                <Row label="Latency" value="~120ms" />
                <Row label="Last Sync" value="Live" />

            </Block>

            {/* ================= SUPPORT BLOCK ================= */}
            <Block title="Support">

                <LinkBtn label="Help" href="https://t.me/fxhedzbot" />
                <LinkBtn label="Telegram" href="https://t.me/fxhedzbot" />
                <LinkBtn label="Risk Disclosure" href="/risk" />
                <LinkBtn label="Terms" href="/terms" />

            </Block>

            {/* ================= LOGOUT ================= */}
            <div className="mt-auto pt-4 border-t border-neutral-800">
                <button
                    onClick={handleLogout}
                    className="w-full text-red-500 font-semibold hover:text-red-400 transition-colors"
                >
                    Sign Out
                </button>
            </div>
        </div>
    )
}

/* ================= COMPONENT HELPERS ================= */

function Block({ title, children }: any) {
    return (
        <div className="space-y-3">
            <div className="text-neutral-400 uppercase text-xs tracking-wider">
                {title}
            </div>
            {children}
        </div>
    )
}

function Row({
    label,
    value,
    highlight,
    mono
}: any) {
    return (
        <div className="flex justify-between">
            <span className="text-neutral-500">{label}</span>
            <span
                className={`
          ${mono ? "font-mono text-xs" : ""}
          ${highlight === "green" ? "text-green-400" : ""}
          ${highlight === "red" ? "text-red-400" : ""}
        `}
            >
                {value}
            </span>
        </div>
    )
}

function DeviceBlock({ deviceId }: { deviceId: string }) {
    return (
        <div className="pt-3 border-t border-neutral-800 space-y-2">

            <div className="text-neutral-500 text-xs tracking-wide">
                Device
            </div>

            <div
                className="
          font-mono text-[clamp(9px,5.5px+1.0937vw,19.5px)]
          text-neutral-400
          leading-snug
          break-all
          bg-neutral-800/40
          border border-neutral-800
          rounded-md
          px-3 py-2
          text-center
        "
            >
                {deviceId}
            </div>

        </div>
    )
}

function LinkBtn({ label, href }: any) {
    return (
        <a
            href={href}
            target="_blank"
            rel="noopener noreferrer"
            className="block text-sky-400 hover:text-sky-300 transition-colors"
        >
            {label}
        </a>
    )
}



// components\DashboardControlBar.tsx
// --------------------------------------------------

"use client"

import React from "react"

type ViewMode = "MIN" | "MID" | "MAX"

export default function DashboardControlBar({
  viewMode,
  onChangeView,
  onMenu
}: {
  viewMode: ViewMode
  onChangeView: (mode: ViewMode) => void
  onMenu?: () => void
}) {

  function Btn({
    label,
    active,
    onClick
  }: {
    label: string
    active?: boolean
    onClick: () => void
  }) {
    return (
      <button
        onClick={onClick}
        className={`px-4 py-2 text-[clamp(9px,5.5px+1.0937vw,19.5px)] font-semibold transition-all duration-200
        ${active
            ? "text-white bg-neutral-800"
            : "text-neutral-400 hover:text-neutral-200"
          }`}
      >
        {label}
      </button>
    )
  }

  return (
    <div
      className="fixed bottom-0 left-0 w-full z-50
                 bg-gradient-to-t from-black to-neutral-900
                 border-t border-neutral-800
                 rounded-t-2xl
                 backdrop-blur-xl"
      style={{
        paddingBottom: "env(safe-area-inset-bottom)"
      }}
    >
      <div className="flex items-center justify-between px-4 py-3">

        {/* LEFT SIDE â€” VIEW CONTROLS */}
        <div className="flex items-center gap-2">

          <Btn
            label="MIN"
            active={viewMode === "MIN"}
            onClick={() => onChangeView("MIN")}
          />

          <Btn
            label="MID"
            active={viewMode === "MID"}
            onClick={() => onChangeView("MID")}
          />

          <Btn
            label="MAX"
            active={viewMode === "MAX"}
            onClick={() => onChangeView("MAX")}
          />

        </div>

        {/* RIGHT SIDE â€” MENU */}
        <button
          onClick={onMenu}
          className="w-9 h-9 flex items-center justify-center
                     rounded-lg bg-neutral-800
                     text-neutral-300 hover:text-white
                     transition-all duration-200"
        >
          â˜°
        </button>

      </div>
    </div>
  )
}



// components\GlobalLightChart.tsx
// --------------------------------------------------

"use client"

import { useEffect, useRef } from "react"
import {
    createChart,
    ColorType,
    CandlestickSeries
} from "lightweight-charts"

export default function GlobalLightChart({
    mountId,
    signal,
    disableOverlays
}: {
    mountId?: string
    signal?: any
    disableOverlays?: boolean
}) {

    const chartRef = useRef<any>(null)
    const candleSeriesRef = useRef<any>(null)
    const dynamicLinesRef = useRef<any[]>([])
    const historyLoadedRef = useRef(false)

    // ==========================================
    // CREATE CHART
    // ==========================================
    useEffect(() => {

        if (!mountId) return

        const container = document.getElementById(mountId)
        if (!container) return

        while (container.firstChild) {
            container.removeChild(container.firstChild)
        }

        const chart = createChart(container, {
            width: container.clientWidth,
            height: container.clientHeight,
            layout: {
                background: { type: ColorType.Solid, color: "#1E1E1E" },
                textColor: "#888",
                fontSize: 10,
                fontFamily: "monospace"
            },
            grid: {
                vertLines: { color: "rgba(255,255,255,0.03)" },
                horzLines: { color: "rgba(255,255,255,0.03)" }
            },
            rightPriceScale: {
                borderColor: "rgba(255,255,255,0.08)"
            },
            timeScale: {
                borderColor: "rgba(255,255,255,0.08)",
                timeVisible: true,
                secondsVisible: false,
                rightOffset: 8,
                barSpacing: 8
            }
        })

        const series = chart.addSeries(CandlestickSeries, {
            upColor: "#22c55e",
            downColor: "#ef4444",
            borderUpColor: "#22c55e",
            borderDownColor: "#ef4444",
            wickUpColor: "#22c55e",
            wickDownColor: "#ef4444"
        })

        chartRef.current = chart
        candleSeriesRef.current = series
        historyLoadedRef.current = false

        const resizeObserver = new ResizeObserver(() => {
            chart.applyOptions({
                width: container.clientWidth,
                height: container.clientHeight
            })
        })

        resizeObserver.observe(container)

        return () => {
            resizeObserver.disconnect()
            chart.remove()
        }

    }, [mountId])

    // ==========================================
    // CANDLE STREAM (IMPORTANT â€” RESTORED)
    // ==========================================
    useEffect(() => {

        const series = candleSeriesRef.current
        if (!series) return
        if (!signal?.candles) return

        const data = signal.candles.map((c: any) => ({
            time: Number(c.time),
            open: Number(c.open),
            high: Number(c.high),
            low: Number(c.low),
            close: Number(c.close)
        }))

        if (!data.length) return

        if (!historyLoadedRef.current) {
            series.setData(data)
            historyLoadedRef.current = true
            return
        }

        const last = data[data.length - 1]
        series.update(last)

    }, [signal?.candles])

    // ==========================================
    // OVERLAY ENGINE
    // ==========================================
    useEffect(() => {

        if (disableOverlays) return

        const candleSeries = candleSeriesRef.current
        if (!candleSeries || !signal) return

        dynamicLinesRef.current.forEach((l: any) => {
            candleSeries.removePriceLine(l)
        })
        dynamicLinesRef.current = []

        let orders = signal?.orders || []

        if (!orders.length && signal?.direction && signal?.entry) {
            orders = [{
                label: signal.direction === "BUY" ? "B1" : "S1",
                entry: signal.entry,
                direction: signal.direction
            }]
        }

        if (!orders.length) return

        const isHedged = signal?.direction === "HEDGED"

        orders.forEach((o: any, index: number) => {

            const entry = Number(o.entry)
            if (!entry) return

            const isLatest = index === orders.length - 1
            const isHedged = signal?.direction === "HEDGED"

            const activeColor =
                o.direction === "BUY"
                    ? "#22c55e"
                    : "#ef4444"

            // Better muted colors (visible but secondary)
            const mutedColor =
                o.direction === "BUY"
                    ? "rgba(34,197,94,0.45)"
                    : "rgba(239,68,68,0.45)"

            const color =
                isLatest && !isHedged
                    ? activeColor
                    : mutedColor

            const entryLine = candleSeries.createPriceLine({
                price: entry,
                color,
                lineWidth: isLatest && !isHedged ? 2 : 2, // keep thickness consistent
                axisLabelVisible: isLatest && !isHedged,
                title: isLatest && !isHedged ? (o.label || "") : ""
            })

            dynamicLinesRef.current.push(entryLine)

            // -------------------------------
            // STOP IF HEDGED
            // -------------------------------
            if (isHedged) return

            // Only latest non-hedged gets SL/TP
            if (!isLatest) return

            const sl = Number(signal?.sl)
            const tp = Number(signal?.tp)

            if (sl) {
                const hedgeLabel =
                    o.direction === "BUY"
                        ? "SS"
                        : "BS"

                const slLine = candleSeries.createPriceLine({
                    price: sl,
                    color: "#ef4444",
                    lineWidth: 1,
                    title: hedgeLabel
                })

                dynamicLinesRef.current.push(slLine)
            }

            if (tp) {
                const tpLine = candleSeries.createPriceLine({
                    price: tp,
                    color: "#22c55e",
                    lineWidth: 1,
                    title: "TP"
                })

                dynamicLinesRef.current.push(tpLine)
            }

        })

    }, [signal])

    return null
}



// components\PairCard.tsx
// --------------------------------------------------

"use client"

import React, { useState, useEffect } from "react"
import GlobalLightChart from "./GlobalLightChart"

type TradeDirection = "BUY" | "SELL" | "HEDGED" | "EXIT" | "--"
type ViewMode = "MIN" | "MAX"

type Props = {
  pair: string
  open?: boolean
  viewMode?: ViewMode
  direction?: TradeDirection
  signal?: any
  history?: any[]
  orders?: any[]
  performance?: any
  notes?: string
  onToggle: () => void
  isGuest?: boolean
}

function PairCard({
  pair,
  open,
  viewMode = "MIN",
  onToggle,
  direction,
  signal,
  history,
  orders,
  performance,
  notes
}: Props) {

  const dir: TradeDirection = direction ?? "--"
  const [liveDir, setLiveDir] = useState<TradeDirection>(dir)
  const [tab, setTab] = useState<"market" | "updates" | "history" | "performance">("market")
  const [liveOrders, setLiveOrders] = useState<any[]>(orders ?? [])
  const [pnlCache, setPnlCache] = useState<Record<string, number>>({})
  const expanded = !!open

  useEffect(() => setLiveDir(dir), [dir])
  useEffect(() => setLiveOrders(orders ?? []), [orders])
  useEffect(() => { if (expanded) setTab("market") }, [expanded])
  useEffect(() => {
    const newCache: Record<string, number> = {}
    liveOrders.forEach(o => {
      const key = o.id || `${o.direction}_${o.entry}_${o.time}`
      newCache[key] = Number(o.profit ?? 0)
    })
    setPnlCache(newCache)
  }, [liveOrders])

  return (
<div
  className={`
    h-full
    text-[clamp(11px,6.66px+1.354vw,24px)]
    relative
    transition-all duration-300
    border border-neutral-800 rounded-none
    overflow-hidden flex flex-col
    ${viewMode === "MIN" && !expanded ? "justify-center" : ""}
    ${expanded ? "z-20 shadow-xl" : "z-0"}
  `}
>

      {/* ================= HEADER ================== */}
      <div
        className="
    flex-shrink-0
    flex flex-col
    justify-center
    px-3
py-[clamp(2px,0.6vh,6px)]
    cursor-pointer
  "
        onClick={(e) => {
          e.stopPropagation()
          onToggle()
        }}
      >

        {signal && (
          <div className="flex flex-col w-full">

            {/* ROW 1 Ã¢â‚¬â€ PAIR + DIRECTION */}
            <div className="flex justify-between items-center">
              <div className="font-semibold text-[clamp(11px,6.66px+1.354vw,24px)] leading-none">
                {pair}
              </div>

              <div className={`font-bold text-[clamp(11px,6.66px+1.354vw,24px)] ${liveDir === "BUY"
                ? "text-green-400"
                : liveDir === "SELL"
                  ? "text-red-400"
                  : liveDir === "HEDGED"
                    ? "text-sky-400"
                    : "text-neutral-500"
                }`}>
                {liveDir}
              </div>
            </div>

            {/* ROW 2 Ã¢â‚¬â€ LOTS + B/S COUNT */}
            <div className="mt-[clamp(1px,0.4vw,6px)] flex justify-between items-center text-[clamp(9px,5.5px+1.0937vw,19.5px)] leading-none">
              <div className="text-neutral-400">
                {signal?.lots ?? "-"} LOTS
              </div>

              <div className="font-semibold">
                <span className="text-green-400">{signal?.buys ?? 0}B</span>
                <span className="text-neutral-500 px-1">/</span>
                <span className="text-red-400">{signal?.sells ?? 0}S</span>
              </div>
            </div>

            {/* ROW 3 Ã¢â‚¬â€ TRADE BAR */}
            <div className="mt-[clamp(1px,0.8vw,10px)]">
              <InlineTradeStrip
                signal={signal}
                direction={liveDir}
              />
            </div>

          </div>
        )}
      </div>

      {/* ================= EXPANDED CONTENT ================ */}
      {expanded && (
        <div className="border-t border-neutral-800 flex flex-col flex-1 min-h-0 overflow-y-auto">

          {/* TABS */}
          <div className="flex w-full border-b border-neutral-800 text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
            <TabBtn label="Market" active={tab === "market"} onClick={() => setTab("market")} />
            <TabBtn label="Updates" active={tab === "updates"} onClick={() => setTab("updates")} />
            <TabBtn label="History" active={tab === "history"} onClick={() => setTab("history")} />
            <TabBtn label="Performance" active={tab === "performance"} onClick={() => setTab("performance")} />
          </div>

          <div className="p-3 space-y-3 flex flex-col h-full">

            {/* ================= MARKET ================= */}
            {tab === "market" && (
              <>
                <div
                  id={`chart_mount_${pair}`}
                  className="w-full h-[35vh] min-h-[180px] max-h-[320px]"
                />
                <GlobalLightChart
                  mountId={`chart_mount_${pair}`}
                  signal={signal}
                />

                <div>
                  <div className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400">Latest Signal</div>
                  <div className="font-bold text-lg">
                    {signal?.direction || "--"} {signal?.entry || ""}
                  </div>
                  <div className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400">
                    SL {signal?.sl || "--"} Ã‚Â· TP {signal?.tp || "--"}
                  </div>
                </div>

                <div className="bg-neutral-800 rounded-lg p-2 text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-300">
                  <div className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400 mb-2">Active Orders</div>

                  <div className="flex-1 min-h-0 overflow-y-auto space-y-2 pr-1">
                    {liveOrders?.length ? liveOrders.map((o, i) => {

                      const key = o.id || `${o.direction}_${o.entry}_${o.time}`
                      const pnl = Number(o.profit ?? 0)
                      const prev = pnlCache[key] ?? pnl

                      const pnlColor =
                        pnl > 0
                          ? "text-green-400"
                          : pnl < 0
                            ? "text-red-400"
                            : "text-neutral-400"

                      let pulseClass = ""
                      if (pnl > prev) pulseClass = "ring-1 ring-green-400/40"
                      if (pnl < prev) pulseClass = "ring-1 ring-red-400/40"

                      return (
                        <div
                          key={key}
                          className={`bg-neutral-900 px-2 py-2 min-h-[38px] rounded-md text-xs flex justify-between ...`}
                        >
                          <div>
                            <div className={`font-semibold ${o.direction === "BUY"
                              ? "text-green-400"
                              : "text-red-400"
                              }`}>
                              {o.direction}
                            </div>
                            <div className="text-neutral-400">
                              ENTRY {o.entry}
                            </div>
                          </div>

                          <div className="text-right">
                            <div className="text-neutral-400">
                              {o.lots}
                            </div>
                            <div className={pnlColor}>
                              {pnl.toFixed(2)}
                            </div>
                          </div>
                        </div>
                      )

                    }) : (
                      <div className="text-neutral-500 text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                        No open orders
                      </div>
                    )}
                  </div>
                </div>
              </>
            )}

            {/* ================= UPDATES ================= */}
            {tab === "updates" && (
              <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

                <div className="shrink-0 text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400 mb-2">
                  Market Commentary
                </div>

                <div className="flex-1 min-h-0 overflow-y-auto bg-neutral-900 border border-neutral-800 p-[clamp(10px,1.4vw,16px)] text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                  {notes || "Coming Soon"}
                </div>

              </div>
            )}

            {/* ================= HISTORY ================= */}
            {tab === "history" && (
              <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

                <div className="flex-1 min-h-0 overflow-y-auto space-y-3 pr-1">

                  {history?.length ? history.map((h: any, i: number) => (
                    <div
                      key={i}
                      className="bg-neutral-900 border border-neutral-800 p-[clamp(8px,1vw,14px)] flex justify-between text-[clamp(9px,5.5px+1.0937vw,19.5px)]"
                    >
                      <div>
                        <div className={h.direction === "BUY" ? "text-green-400" : "text-red-400"}>
                          {h.direction}
                        </div>
                        <div className="text-xs text-neutral-400">
                          {h.entry} Ã¢â€ â€™ {h.exit}
                        </div>
                      </div>
                      <div className={h.pnl >= 0 ? "text-green-400" : "text-red-400"}>
                        {h.pnl}
                      </div>
                    </div>
                  )) : (
                    <div className="text-neutral-500 text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                      No history yet
                    </div>
                  )}

                </div>

              </div>
            )}

            {/* ================= PERFORMANCE ================= */}
            {tab === "performance" && (
              <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

                <div className="flex-1 min-h-0 overflow-y-auto space-y-[clamp(8px,1vh,16px)] pr-1">

                  {/* TOP METRICS */}
                  <div className="grid grid-cols-2 gap-[clamp(6px,1vw,14px)] text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                    <Metric
                      label="Win Rate"
                      value={
                        performance?.winRate !== undefined
                          ? performance.winRate + "%"
                          : "--"
                      }
                    />
                    <Metric
                      label="Profit Factor"
                      value={performance?.profitFactor ?? "--"}
                    />
                  </div>

                  {/* STAT LIST */}
                  <div className="space-y-[clamp(6px,1vh,12px)] text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                    <Stat label="Total Trades" value={performance?.trades} />
                    <Stat label="Wins" value={performance?.wins} />
                    <Stat label="Losses" value={performance?.losses} />
                    <Stat label="Total PnL" value={performance?.pnlTotal} />
                  </div>

                </div>

              </div>
            )}

          </div>
        </div>
      )}

    </div>
  )
}

/* ====================================================== */

function TabBtn({ label, active, onClick }: any) {
  return (
    <button
      onClick={(e) => { e.stopPropagation(); onClick() }}
      className={`flex-1 py-3 text-center transition-all duration-200 ${active
        ? "text-white border-b-2 border-white bg-neutral-900"
        : "text-neutral-500 hover:text-neutral-300"
        }`}
    >
      {label}
    </button>
  )
}

function Stat({ label, value }: any) {
  return (
    <div className="flex justify-between bg-neutral-800 border border-neutral-700 p-[clamp(8px,1vw,14px)]">
      <span className="text-neutral-400">{label}</span>
      <span className="font-semibold">{value ?? "--"}</span>
    </div>
  )
}

function Metric({ label, value }: any) {
  return (
    <div className="bg-neutral-800 border border-neutral-700 p-[clamp(10px,1.4vw,18px)] text-center">
      <div className="text-neutral-400 text-[clamp(9px,5.5px+1.0937vw,19.5px)]">{label}</div>
      <div className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] font-semibold">{value ?? "--"}</div>
    </div>
  )
}

/* =====================================================
   INLINE STRIP (MIN MODE)
======================================================= */

function InlineTradeStrip({ signal, direction }: any) {
  if (!signal?.entry || direction === "EXIT") return null

  const sl = Number(signal?.sl)
  const tp = Number(signal?.tp)
  const entry = Number(signal?.entry)
  const price = Number(signal?.price || entry)

  if (!sl || !tp) return null

  const isHedged = direction === "HEDGED"

  let pricePercent = 50

  if (direction === "LIVE+") {
    pricePercent = 50
  }

  if (!isHedged && direction !== "LIVE+") {
    if (direction === "BUY") {
      const leftRange = Math.abs(entry - sl)
      const rightRange = Math.abs(tp - entry)

      if (price < entry && leftRange > 0)
        pricePercent = 50 - ((entry - price) / leftRange) * 50

      if (price > entry && rightRange > 0)
        pricePercent = 50 + ((price - entry) / rightRange) * 50
    }

    if (direction === "SELL") {
      const leftRange = Math.abs(tp - entry)
      const rightRange = Math.abs(entry - sl)

      if (price > entry && rightRange > 0)
        pricePercent = 50 - ((price - entry) / rightRange) * 50

      if (price < entry && leftRange > 0)
        pricePercent = 50 + ((entry - price) / leftRange) * 50
    }

    pricePercent = Math.max(0.9, Math.min(99.2, pricePercent))
  }

  const isTPside =
    direction === "BUY"
      ? price >= entry
      : direction === "SELL"
        ? price <= entry
        : false

  return (
    <div className="flex flex-col w-full gap-[clamp(1px,0.5vw,6px)]">

      <div className="relative w-full h-[clamp(2px,0.35vw,6px)]">

        <div className="absolute inset-0 bg-neutral-800 rounded-full" />

        {/* LEFT HALF */}
        <div
          className={`absolute left-0 h-full w-1/2 ${isHedged
            ? "bg-sky-500/70"
            : "bg-red-500/70"
            }`}
        />

        {/* RIGHT HALF */}
        <div
          className={`absolute right-0 h-full w-1/2 ${isHedged
            ? "bg-sky-500/70"
            : "bg-green-500/70"
            }`}
        />

        {/* SL DOT */}
        <div className="absolute left-0 top-1/2 -translate-y-1/2 w-[clamp(6px,1.3vw,28px)] h-[clamp(6px,1.3vw,28px)] rounded-full border border-neutral-500 bg-black" />

        {/* ENTRY DOT */}
        <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[clamp(6px,1.3vw,28px)] h-[clamp(6px,1.3vw,28px)] rounded-full bg-neutral-400" />

        {/* TP DOT */}
        <div className="absolute right-0 top-1/2 -translate-y-1/2 w-[clamp(6px,1.3vw,28px)] h-[clamp(6px,1.3vw,28px)] rounded-full border border-neutral-500 bg-black" />

        {/* LIVE DOT CONTAINER */}
        <div
          className="absolute top-1/2 flex items-center justify-center"
          style={{
            left: `${pricePercent}%`,
            transform: "translate(-50%, -50%)",
            transition: "left 300ms ease",
            width: "1px", // Minimal anchor point
            height: "1px"
          }}
        >
          {/* OUTER PULSE */}
          <div
            className={`
      absolute
      w-[clamp(12px,1.8vw,36px)]
      h-[clamp(12px,1.8vw,36px)]
      rounded-full
      animate-ping
      ${isHedged ? "bg-sky-400/35" : isTPside ? "bg-green-400/35" : "bg-red-400/35"}
    `}
            style={{ animationDuration: "0.85s" }}
          />

          {/* HALO (Glow Effect) */}
          <div
            className={`
      absolute
      w-[clamp(9px,1.4vw,28px)]
      h-[clamp(9px,1.4vw,28px)]
      rounded-full
      blur-md
      ${isHedged ? "bg-sky-500/45" : isTPside ? "bg-green-500/45" : "bg-red-500/45"}
    `}
          />

          {/* CORE DOT */}
          <div
            className={`
      absolute
      w-[clamp(6px,1.1vw,20px)]
      h-[clamp(6px,1.1vw,20px)]
      rounded-full
      shadow-[0_0_10px_rgba(0,0,0,0.5)]
      ${isHedged ? "bg-sky-400" : isTPside ? "bg-green-400" : "bg-red-400"}
    `}
          />
        </div>
      </div>

      <div className="flex justify-between text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400">
        <span>{sl}</span>
        <span>{entry}</span>
        <span>{tp}</span>
      </div>
    </div>
  )
}

/* ======================================================
   TRADE BAR (MID / MAX MODE)
====================================================== */

function TradeBar({
  signal,
  direction
}: {
  signal: any
  direction?: "BUY" | "SELL" | "HEDGED" | "EXIT" | "--"
}) {

  const sl = Number(signal?.sl)
  const tp = Number(signal?.tp)
  const entry = Number(signal?.entry)
  const price = Number(signal?.price || entry)

  if (direction === "EXIT") return null
  if (!sl || !tp || !entry) return null

  const entryPercent = 50
  let pricePercent = 50

  if (direction === "BUY") {
    const leftRange = Math.abs(entry - sl)
    const rightRange = Math.abs(tp - entry)

    if (price < entry && leftRange > 0)
      pricePercent = 50 - ((entry - price) / leftRange) * 50

    if (price > entry && rightRange > 0)
      pricePercent = 50 + ((price - entry) / rightRange) * 50
  }

  if (direction === "SELL") {
    const leftRange = Math.abs(tp - entry)
    const rightRange = Math.abs(entry - sl)

    if (price > entry && rightRange > 0)
      pricePercent = 50 - ((price - entry) / rightRange) * 50

    if (price < entry && leftRange > 0)
      pricePercent = 50 + ((entry - price) / leftRange) * 50
  }

  pricePercent = Math.max(0.9, Math.min(99.2, pricePercent))

  const isTPside =
    direction === "BUY"
      ? price >= entry
      : price <= entry

  return (
    <div className="mt-3 select-none">

      <div className="relative h-3 text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400 mb-1">
        <span className="absolute left-0">SL / HEDZ</span>
        <span
          className="absolute"
          style={{
            left: `${entryPercent}%`,
            transform: "translateX(-50%)"
          }}
        >
          ENTRY
        </span>
        <span className="absolute right-0">TP</span>
      </div>

      <div className="relative h-6 flex items-center overflow-visible">

        <div
          className="absolute h-[clamp(2px,0.35vw,6px)]"
          style={{
            width: `${entryPercent}%`,
            background:
              "linear-gradient(90deg, rgba(248,113,113,0.8), rgba(239,68,68,0.05))"
          }}
        />

        <div
          className="absolute h-[clamp(2px,0.35vw,6px)]"
          style={{
            left: `${entryPercent}%`,
            width: `${100 - entryPercent}%`,
            background:
              "linear-gradient(90deg, rgba(34,197,94,0.05), rgba(74,222,128,0.8))"
          }}
        />

        <div className="absolute left-0 w-3 h-3 rounded-full border border-neutral-400" />
        <div
          className="absolute w-3 h-3 rounded-full border border-neutral-400"
          style={{
            left: `${entryPercent}%`,
            transform: "translateX(-50%)"
          }}
        />
        <div className="absolute right-0 w-3 h-3 rounded-full border border-neutral-400" />

        <div
          className="absolute"
          style={{
            left: `${pricePercent}%`,
            transform: "translateX(-50%)",
            transition: "left 380ms cubic-bezier(0.22,1,0.36,1)"
          }}
        >
          <div
            className={`absolute -inset-2 rounded-full blur-md ${isTPside ? "bg-green-500/30" : "bg-red-500/30"
              }`}
          />
          <div
            className={`w-3 h-3 rounded-full ${isTPside ? "bg-green-400" : "bg-red-400"
              }`}
          />
        </div>

      </div>

      <div className="flex justify-between text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400 mt-1">
        <span>{sl}</span>
        <span>{entry}</span>
        <span>{tp}</span>
      </div>

    </div>
  )
}

export default React.memo(PairCard)



// components\PairDetail.tsx
// --------------------------------------------------

"use client"

import GlobalLightChart from "./GlobalLightChart"
import { useState, useEffect } from "react"

type Props = {
    pair: string
    signal: any
    data: any
    onClose: () => void
    isGuest?: boolean
    email?: string
    appInstruments: string[]
    setAppInstruments: React.Dispatch<React.SetStateAction<string[]>>
}

export default function PairDetail({
    pair,
    signal,
    data,
    onClose,
    isGuest = false,
    email,
    appInstruments,
    setAppInstruments
}: Props) {

    const [tab, setTab] = useState<"market" | "updates" | "history" | "performance">("market")
    const [preview, setPreview] = useState<any>(null)
    const [saving, setSaving] = useState(false)

    useEffect(() => {
        if (preview) {
            document.body.style.overflow = "hidden"
        } else {
            document.body.style.overflow = "auto"
        }
    }, [preview])

const toggleNotification = async () => {

  if (!pair || saving) return

  setSaving(true)

  let isRemoving = false

  setAppInstruments(prev => {

    if (prev.includes(pair)) {
      isRemoving = true
      return prev.filter(p => p !== pair)
    }

    return [...prev, pair]
  })

  try {

    await fetch("/api/toggle-notification", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        pair,
        action: isRemoving ? "remove" : "add"
      })
    })

  } finally {
    setSaving(false)
  }
}
    return (
        <div className="flex flex-col h-full bg-black min-h-0">

            {/* HEADER */}
            <div className="shrink-0 flex items-center justify-between px-3 py-[clamp(6px,1vh,10px)] border-b border-neutral-800">

                <div className="flex items-center gap-3">

                    <div className="font-semibold text-[clamp(11px,6.66px+1.354vw,24px)] leading-none">
                        {pair}
                    </div>

                    {!isGuest && (
                        <button
                            onClick={toggleNotification}
                            disabled={saving}
                            className={`
      w-[1.1em]
      h-[1.1em]
      flex items-center justify-center
      rounded-[2px]
      border
      transition-colors duration-150
      ${appInstruments.includes(pair)
                                    ? "border-sky-500/40 text-sky-400"
                                    : "border-neutral-700 text-neutral-600"
                                }
    `}
                        >
                            <svg
                                className="w-[70%] h-[70%]"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                strokeWidth="2"
                                strokeLinecap="round"
                                strokeLinejoin="round"
                            >
                                <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7" />
                                <path d="M13.73 21a2 2 0 01-3.46 0" />
                            </svg>
                        </button>
                    )}

                </div>

                <button
                    onClick={onClose}
                    className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400 hover:text-white leading-none"
                >
                    CLOSE
                </button>
            </div>

            {/* CHART (FIXED HEIGHT) */}
            <div className="shrink-0 h-[clamp(180px,35vh,380px)]">
                <div
                    id={`chart_mount_${pair}`}
                    className="w-full h-full"
                />
                <GlobalLightChart
                    mountId={`chart_mount_${pair}`}
                    signal={isGuest ? data : signal}
                    disableOverlays={isGuest}
                />
            </div>

            {/* TABS (FIXED) */}
            <div className="shrink-0 flex border-b border-neutral-800 text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                <Tab label="Market" active={tab === "market"} onClick={() => setTab("market")} />
                <Tab label="Updates" active={tab === "updates"} onClick={() => setTab("updates")} />
                <Tab label="History" active={tab === "history"} onClick={() => setTab("history")} />
                <Tab label="Statistics" active={tab === "performance"} onClick={() => setTab("performance")} />
            </div>

            {/* CONTENT AREA â€” ONLY THIS SCROLLS */}
            <div className="flex-1 flex flex-col min-h-0">

                {tab === "market" && (
                    <div className="flex flex-col flex-1 min-h-0 gap-[clamp(8px,1vh,16px)] p-[clamp(8px,1.2vw,16px)]">


                        <div>
                            <div className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400">Latest Signal</div>
                            <div className="font-semibold text-[clamp(9px,5.5px+1.0937vw,19.5px)] leading-tight">
                                {signal?.direction || "--"} {signal?.entry || ""}
                            </div>
                            <div className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400">
                                SL {signal?.sl || "--"} Â· TP {signal?.tp || "--"}
                            </div>
                        </div>

                        <div className="flex flex-col flex-1 min-h-0 bg-neutral-900 border border-neutral-800 p-[clamp(8px,1vw,14px)] text-[clamp(9px,5.5px+1.0937vw,19.5px)]">

                            <div className="shrink-0 text-neutral-400 mb-2">
                                Active Orders
                            </div>

                            <div className="flex-1 overflow-y-auto space-y-2 pr-1">

                                {data?.orders?.length ? data.orders.map((o: any, i: number) => (
                                    <div
                                        key={i}
                                        className="flex justify-between bg-neutral-800 p-2"
                                    >
                                        <div>
                                            <div className={o.direction === "BUY" ? "text-green-400" : "text-red-400"}>
                                                {o.direction}
                                            </div>
                                            <div className="text-neutral-400 text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                                                {/*ENTRY*/} {o.entry}
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div>{o.lots}</div>
                                            <div className={Number(o.profit) >= 0 ? "text-green-400" : "text-red-400"}>
                                                {Number(o.profit).toFixed(2)}
                                            </div>
                                        </div>
                                    </div>
                                )) : (
                                    <div className="text-neutral-500">
                                        No open orders
                                    </div>
                                )}
                            </div>
                        </div>

                    </div>
                )}

                {tab === "updates" && (
                    <div className="flex flex-col flex-1 min-h-0">

                        <div className="flex-1 overflow-y-auto space-y-2.5 p-[clamp(8px,1.2vw,16px)]">

                            {data?.feed?.length ? data.feed.map((post: any, i: number) => (

                                <div
                                    key={i}
                                    onClick={() => setPreview(post)}
                                    className="bg-neutral-900 border border-neutral-800 overflow-hidden cursor-pointer"
                                >
                                    <div className="flex">

                                        {post.image && (
                                            <div className="w-[120px] shrink-0 overflow-hidden">
                                                <img
                                                    src={`https://drive.google.com/thumbnail?id=${post.image}&sz=w800`}
                                                    className="w-full h-full object-cover"
                                                />
                                            </div>
                                        )}

                                        <div className="flex-1 px-3 py-2 space-y-1.5">

                                            <div className="flex items-center justify-between">
                                                <div className="text-[clamp(8px,4.66px+1.0416vw,18px)] text-neutral-400">
                                                    {new Date(post.time).toLocaleString()}
                                                </div>

                                                {post.text.includes("BUY") && (
                                                    <span className="text-green-400 text-[clamp(9px,5.5px+1.0937vw,19.5px)] font-semibold">BULLISH</span>
                                                )}
                                                {post.text.includes("SELL") && (
                                                    <span className="text-red-400 text-[clamp(9px,5.5px+1.0937vw,19.5px)] font-semibold">BEARISH</span>
                                                )}
                                            </div>

                                            <div
                                                className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] leading-4 text-neutral-200 whitespace-pre-line"
                                                dangerouslySetInnerHTML={{ __html: post.text }}
                                            />

                                        </div>
                                    </div>
                                </div>

                            )) : (
                                <div className="text-neutral-500 text-center">
                                    No updates yet
                                </div>
                            )}

                        </div>
                    </div>
                )}

                {tab === "history" && (
                    <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

                        <div className="flex-1 min-h-0 overflow-y-auto space-y-3 pr-1">

                            {data?.history?.length ? data.history.map((h: any, i: number) => (
                                <div
                                    key={i}
                                    className="bg-neutral-900 border border-neutral-800 p-[clamp(8px,1vw,14px)] flex justify-between text-[clamp(9px,5.5px+1.0937vw,19.5px)]"
                                >
                                    <div>
                                        <div className={h.direction === "BUY" ? "text-green-400" : "text-red-400"}>
                                            {h.direction}
                                        </div>
                                        <div className="text-xs text-neutral-400 text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                                            {h.entry} â†’ {h.exit}
                                        </div>
                                    </div>
                                    <div className={h.pnl >= 0 ? "text-green-400" : "text-red-400"}>
                                        {h.pnl}
                                    </div>
                                </div>
                            )) : (
                                <div className="text-neutral-500 text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                                    No history yet
                                </div>
                            )}

                        </div>

                    </div>
                )}

                {tab === "performance" && (
                    <div className="flex flex-col flex-1 min-h-0 p-[clamp(8px,1.2vw,16px)]">

                        <div className="flex-1 min-h-0 overflow-y-auto space-y-[clamp(8px,1vh,16px)] pr-1">

                            <div className="grid grid-cols-2 gap-[clamp(6px,1vw,14px)] text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                                <Metric
                                    label="Win Rate"
                                    value={
                                        data?.performance?.winRate !== undefined
                                            ? data.performance.winRate + "%"
                                            : "--"
                                    }
                                />
                                <Metric
                                    label="Profit Factor"
                                    value={data?.performance?.profitFactor ?? "--"}
                                />
                            </div>

                            <div className="space-y-[clamp(6px,1vh,12px)] text-[clamp(9px,5.5px+1.0937vw,19.5px)]">
                                <Stat label="Total Trades" value={data?.performance?.trades} />
                                <Stat label="Wins" value={data?.performance?.wins} />
                                <Stat label="Losses" value={data?.performance?.losses} />
                                <Stat label="Total PnL" value={data?.performance?.pnlTotal} />
                            </div>

                        </div>

                    </div>
                )}
            </div>

            {/* MODAL PREVIEW */}
            {preview && (
                <div
                    className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50"
                    onClick={() => setPreview(null)}
                >
                    <div
                        className="bg-neutral-900 max-w-[700px] w-[92%] rounded-xl overflow-hidden"
                        onClick={(e) => e.stopPropagation()}
                    >
                        {preview.image && (
                            <img
                                src={`https://drive.google.com/thumbnail?id=${preview.image}&sz=w2000`}
                                className="w-full object-contain"
                            />
                        )}

                        <div className="p-5 space-y-3">
                            <div className="text-sm text-neutral-400">
                                {new Date(preview.time).toLocaleString()}
                            </div>

                            <div
                                className="text-neutral-200 whitespace-pre-line"
                                dangerouslySetInnerHTML={{ __html: preview.text }}
                            />
                        </div>
                    </div>
                </div>
            )}

        </div>
    )
}

function Tab({ label, active, onClick }: any) {
    return (
        <button
            onClick={onClick}
            className={`
        flex-1
        py-[clamp(6px,1vh,12px)]
        text-[clamp(9px,5.5px+1.0937vw,19.5px)]
        leading-none
        transition-all
        ${active
                    ? "text-white border-b-2 border-white bg-neutral-900"
                    : "text-neutral-500 hover:text-neutral-300"}
      `}
        >
            {label.toUpperCase()}
        </button>
    )
}

function Stat({ label, value }: any) {
    return (
        <div className="flex justify-between bg-neutral-800 border border-neutral-700 p-[clamp(8px,1vw,14px)]">
            <span className="text-neutral-400">{label}</span>
            <span className="font-semibold">{value ?? "--"}</span>
        </div>
    )
}

function Metric({ label, value }: any) {
    return (
        <div className="bg-neutral-800 border border-neutral-700 p-[clamp(10px,1.4vw,18px)] text-center">
            <div className="text-neutral-400 text-[clamp(9px,5.5px+1.0937vw,19.5px)]">{label}</div>
            <div className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] font-semibold">{value ?? "--"}</div>
        </div>
    )
}



// components\Providers.tsx
// --------------------------------------------------

"use client"

import { SessionProvider } from "next-auth/react"

export default function Providers({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <SessionProvider>
      {children}
    </SessionProvider>
  )
}



// components\VerticalSymbolButton.tsx
// --------------------------------------------------

"use client"

type Props = {
  pair: string
  active?: boolean
  onClick: () => void
}

function splitPair(pair: string) {
  const knownQuotes = ["USD", "JPY", "CHF", "OIL"]

  for (const quote of knownQuotes) {
    if (pair.endsWith(quote)) {
      return {
        base: pair.slice(0, pair.length - quote.length),
        quote
      }
    }
  }

  return {
    base: pair.slice(0, 3),
    quote: pair.slice(3)
  }
}

export default function VerticalSymbolButton({
  pair,
  active = false,
  onClick
}: Props) {

  const { base, quote } = splitPair(pair)

  return (
    <button
      onClick={onClick}
      className={`
        h-full w-full
        flex items-center justify-center
        border border-neutral-800
        rounded-none
        ${active
          ? "bg-neutral-900 text-white border-sky-400"
          : "bg-neutral-950 text-neutral-500 hover:bg-neutral-900"
        }
      `}
    >
      <div className="flex flex-col items-center leading-[1.05]">
        <span className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] font-semibold tracking-wide">
          {base}
        </span>
        <span className="text-[clamp(9px,5.5px+1.0937vw,19.5px)] text-neutral-400 tracking-wide">
          {quote}
        </span>
      </div>
    </button>
  )
}



// lib\device.ts
// --------------------------------------------------

export function ensureDeviceIdentity() {
  if (typeof window === "undefined") return null

  const isAndroid =
    typeof window !== "undefined" &&
    (window as any).ReactNativeWebView

  let deviceId: string | null = localStorage.getItem("fxhedz_device_id")
  let fingerprint: string | null = localStorage.getItem("fxhedz_fp")

  // ===============================
  // ANDROID: Use native device ID
  // ===============================
  if (isAndroid && (window as any).__NATIVE_DEVICE_ID__) {

    const nativeId = String((window as any).__NATIVE_DEVICE_ID__)

    deviceId = nativeId
    fingerprint = nativeId

    localStorage.setItem("fxhedz_device_id", nativeId)
    localStorage.setItem("fxhedz_fp", nativeId)

  } else {

    // ===============================
    // WEB: Generate if missing
    // ===============================

    if (!deviceId) {
      deviceId = crypto.randomUUID()
      localStorage.setItem("fxhedz_device_id", deviceId)
    }

    if (!fingerprint) {

      const raw =
        navigator.userAgent +
        screen.width +
        screen.height

      fingerprint =
        crypto.randomUUID() + "-" + btoa(raw).slice(0, 12)

      localStorage.setItem("fxhedz_fp", fingerprint)
    }
  }

  // At this point both MUST be strings
  const finalDeviceId = deviceId ?? ""
  const finalFingerprint = fingerprint ?? ""

  document.cookie = `fx_device=${finalDeviceId}; path=/; max-age=31536000`
  document.cookie = `fx_fp=${finalFingerprint}; path=/; max-age=31536000`

  return { deviceId: finalDeviceId, fingerprint: finalFingerprint }
}



// lib\dummyDetail.ts
// --------------------------------------------------

export function generateDummyDetail(pair: string) {

  const history = [
    { direction: "BUY", entry: 1.0800, exit: 1.0865, pnl: 65.00 },
    { direction: "SELL", entry: 1.0920, exit: 1.0850, pnl: 70.00 },
    { direction: "BUY", entry: 1.0700, exit: 1.0680, pnl: -20.00 }
  ]

  const performance = {
    winRate: 73,
    profitFactor: 1.82,
    trades: 48,
    wins: 35,
    losses: 13,
    pnlTotal: 1245.60
  }

  return {
    history,
    performance,
    notes: "Institutional accumulation detected. Liquidity engineering active."
  }
}



// lib\dummySignals.ts
// --------------------------------------------------

export function generateDummySignals() {

  return {

    XAUUSD: {
      direction: "SELL",
      entry: 2356.40,
      sl: 2374.90,
      tp: 2331.20,
      price: 2352.85,
      lots: 2.80,
      buys: 0,
      sells: 3,
      orders: [
        { id: "x1", direction: "SELL", entry: 2356.40, lots: 1.00, profit: 35.50, time: "10:14:22" },
        { id: "x2", direction: "SELL", entry: 2359.10, lots: 0.90, profit: 56.25, time: "10:22:48" },
        { id: "x3", direction: "SELL", entry: 2361.75, lots: 0.90, profit: 80.10, time: "10:33:11" }
      ]
    },

    BTCUSD: {
      direction: "BUY",
      entry: 64820.00,
      sl: 63600.00,
      tp: 67250.00,
      price: 65240.50,
      lots: 0.85,
      buys: 2,
      sells: 0,
      orders: [
        { id: "b1", direction: "BUY", entry: 64820.00, lots: 0.40, profit: 168.20, time: "09:18:44" },
        { id: "b2", direction: "BUY", entry: 65010.30, lots: 0.45, profit: 103.75, time: "09:41:09" }
      ]
    },

    ETHUSD: {
      direction: "BUY",
      entry: 3482.15,
      sl: 3368.40,
      tp: 3665.90,
      price: 3511.60,
      lots: 3.20,
      buys: 3,
      sells: 0,
      orders: [
        { id: "e1", direction: "BUY", entry: 3482.15, lots: 1.20, profit: 35.30, time: "11:02:18" },
        { id: "e2", direction: "BUY", entry: 3474.90, lots: 1.00, profit: 36.70, time: "11:07:53" },
        { id: "e3", direction: "BUY", entry: 3490.10, lots: 1.00, profit: 21.50, time: "11:16:31" }
      ]
    },

    EURUSD: {
      direction: "SELL",
      entry: 1.0864,
      sl: 1.0932,
      tp: 1.0748,
      price: 1.0841,
      lots: 5.60,
      buys: 1,
      sells: 4,
      orders: [
        { id: "eu1", direction: "SELL", entry: 1.0864, lots: 1.40, profit: 32.20, time: "12:02:14" },
        { id: "eu2", direction: "SELL", entry: 1.0878, lots: 1.50, profit: 55.90, time: "12:05:36" },
        { id: "eu3", direction: "SELL", entry: 1.0859, lots: 1.20, profit: 21.75, time: "12:08:51" },
        { id: "eu4", direction: "BUY", entry: 1.0825, lots: 1.50, profit: -24.60, time: "12:11:09" }
      ]
    },

    GBPUSD: {
      direction: "BUY",
      entry: 1.2745,
      sl: 1.2638,
      tp: 1.2910,
      price: 1.2792,
      lots: 4.10,
      buys: 3,
      sells: 1,
      orders: [
        { id: "gu1", direction: "BUY", entry: 1.2745, lots: 1.50, profit: 70.50, time: "08:45:18" },
        { id: "gu2", direction: "BUY", entry: 1.2762, lots: 1.30, profit: 38.40, time: "09:02:33" },
        { id: "gu3", direction: "SELL", entry: 1.2820, lots: 0.80, profit: -18.60, time: "09:17:11" },
        { id: "gu4", direction: "BUY", entry: 1.2730, lots: 0.50, profit: 31.10, time: "09:29:04" }
      ]
    },

    USDJPY: {
      direction: "SELL",
      entry: 150.82,
      sl: 152.10,
      tp: 148.60,
      price: 150.10,
      lots: 6.75,
      buys: 2,
      sells: 4,
      orders: [
        { id: "uj1", direction: "SELL", entry: 150.82, lots: 2.00, profit: 144.00, time: "07:52:40" },
        { id: "uj2", direction: "SELL", entry: 151.10, lots: 1.80, profit: 180.50, time: "08:06:12" },
        { id: "uj3", direction: "BUY", entry: 149.90, lots: 1.20, profit: 24.80, time: "08:15:21" },
        { id: "uj4", direction: "SELL", entry: 150.45, lots: 1.75, profit: 61.30, time: "08:23:55" }
      ]
    },

    AUDUSD: {
      direction: "BUY",
      entry: 0.6578,
      sl: 0.6489,
      tp: 0.6725,
      price: 0.6604,
      lots: 3.45,
      buys: 2,
      sells: 1,
      orders: [
        { id: "au1", direction: "BUY", entry: 0.6578, lots: 1.40, profit: 36.40, time: "10:11:08" },
        { id: "au2", direction: "SELL", entry: 0.6622, lots: 0.95, profit: -17.60, time: "10:17:45" },
        { id: "au3", direction: "BUY", entry: 0.6559, lots: 1.10, profit: 49.30, time: "10:28:17" }
      ]
    },

    USDCHF: {
      direction: "SELL",
      entry: 0.9026,
      sl: 0.9150,
      tp: 0.8874,
      price: 0.8988,
      lots: 2.95,
      buys: 1,
      sells: 2,
      orders: [
        { id: "uc1", direction: "SELL", entry: 0.9026, lots: 1.10, profit: 41.80, time: "13:05:44" },
        { id: "uc2", direction: "SELL", entry: 0.9051, lots: 1.25, profit: 79.10, time: "13:11:29" },
        { id: "uc3", direction: "BUY", entry: 0.8970, lots: 0.60, profit: 10.80, time: "13:18:02" }
      ]
    },

    USOIL: {
      direction: "BUY",
      entry: 78.40,
      sl: 75.10,
      tp: 83.60,
      price: 79.35,
      lots: 4.60,
      buys: 3,
      sells: 1,
      orders: [
        { id: "o1", direction: "BUY", entry: 78.40, lots: 1.80, profit: 171.00, time: "06:42:13" },
        { id: "o2", direction: "SELL", entry: 80.10, lots: 0.90, profit: -67.50, time: "06:55:47" },
        { id: "o3", direction: "BUY", entry: 77.95, lots: 1.20, profit: 168.00, time: "07:10:25" },
        { id: "o4", direction: "BUY", entry: 78.10, lots: 0.70, profit: 87.50, time: "07:21:38" }
      ]
    }

  }
}



// lib\jwt.ts
// --------------------------------------------------

import jwt from "jsonwebtoken"

export function verifyAccessToken(req: Request) {
  const authHeader = req.headers.get("authorization")

  if (!authHeader?.startsWith("Bearer ")) return null

  const token = authHeader.replace("Bearer ", "")

  try {
    return jwt.verify(token, process.env.FXHEDZ_SECRET!)
  } catch {
    return null
  }
}



// package.json
// --------------------------------------------------

{
  "name": "fxhedz",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "set NEXT_DISABLE_TURBOPACK=1 && next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@dnd-kit/core": "^6.3.1",
    "@dnd-kit/sortable": "^10.0.0",
    "@dnd-kit/utilities": "^3.2.2",
    "@vercel/analytics": "^1.6.1",
    "google-auth-library": "^10.5.0",
    "jsonwebtoken": "^9.0.3",
    "lightweight-charts": "^5.1.0",
    "next": "16.1.6",
    "next-auth": "^4.24.13",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@types/jsonwebtoken": "^9.0.10",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.4.24",
    "cross-env": "^10.1.0",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.4",
    "typescript": "^5"
  }
}



// next.config.ts
// --------------------------------------------------

import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  reactStrictMode: false,
};

export default nextConfig;



// tsconfig.json
// --------------------------------------------------

{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}


